<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task 2 - Gmail Creation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* PREMIUM THEME */
        body { background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: #fff; font-family: 'Poppins', sans-serif; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: #00d2ff; text-transform: uppercase; }
        
        .status-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        
        /* DATA DISPLAY */
        .task-info { background: rgba(0, 210, 255, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #00d2ff; margin-bottom: 20px; }
        .data-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        .label { color: #aaa; font-size: 0.9rem; }
        .val { font-family: monospace; font-size: 1rem; color: #fff; }

        /* INPUTS */
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: white; border-radius: 8px; box-sizing: border-box; outline: none; }
        input:focus { border-color: #00d2ff; }

        .btn { width: 100%; padding: 12px; border: none; font-weight: bold; cursor: pointer; border-radius: 8px; color: #fff; font-size: 1rem; transition: 0.3s; margin-top: 10px; }
        .btn-apply { background: linear-gradient(45deg, #00d2ff, #3a7bd5); }
        .btn-submit { background: linear-gradient(45deg, #00b09b, #96c93d); }
        
        .waiting-anim { font-size: 3rem; color: #00d2ff; margin: 20px; text-align: center; }
        .reward-msg { text-align: center; font-size: 1.2rem; color: #2ecc71; font-weight: bold; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Task 2 Zone</h2>
    <div id="statusText" class="status-box">Loading...</div>

    <!-- 1. APPLY SECTION -->
    <div id="applySection" style="display:none; text-align:center;">
        <p>Apply to get a new Gmail Task.</p>
        <button class="btn btn-apply" onclick="applyTask()">APPLY NOW</button>
    </div>

    <!-- 2. WAITING FOR ADMIN -->
    <div id="waitingSection" style="display:none; text-align:center;">
        <div class="waiting-anim"><i class="fas fa-sync fa-spin"></i></div>
        <p>Waiting for Admin to assign data...</p>
    </div>

    <!-- 3. WORK SECTION (Admin Data Show) -->
    <div id="workSection" style="display:none;">
        <p style="text-align:center; color:#00d2ff;">Create Gmail with this info:</p>
        <div class="task-info">
            <div class="data-row"><span class="label">First Name:</span> <span class="val" id="showFname">...</span></div>
            <div class="data-row"><span class="label">Req. Email:</span> <span class="val" id="showEmail">...</span></div>
            <div class="data-row"><span class="label">Password:</span> <span class="val" id="showPass">...</span></div>
        </div>

        <input type="text" id="subEmail" placeholder="Enter Created Gmail">
        <input type="text" id="subPass" placeholder="Enter Password Used">
        <button class="btn btn-submit" onclick="submitWork()">SUBMIT TASK</button>
    </div>

    <!-- 4. UNDER REVIEW -->
    <div id="reviewSection" style="display:none; text-align:center;">
        <i class="fas fa-hourglass-half" style="font-size:3rem; color:#ffd700; margin:15px;"></i>
        <p>Your work is under review.</p>
    </div>

    <!-- 5. COMPLETED -->
    <div id="completedSection" style="display:none; text-align:center;">
        <div class="reward-msg">
            <i class="fas fa-check-circle"></i> Task Approved!<br>
            Reward: <span id="rewardAmount">0</span> TK
        </div>
        <button class="btn btn-apply" onclick="resetTask()">DO ANOTHER TASK</button>
    </div>
    
    <a href="home.html" style="display:block; text-align:center; margin-top:20px; color:#aaa; text-decoration:none;">Back to Home</a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getDatabase, ref, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    // আপনার ফায়ারবেস কনফিগ এখানে দিন
    const firebaseConfig = { apiKey: "AIzaSyB2YLhAvSF12ZZx7LSnbqcCjtS2_8QLt4o", authDomain: "task-f6078.firebaseapp.com", databaseURL: "https://task-f6078-default-rtdb.firebaseio.com", projectId: "task-f6078", storageBucket: "task-f6078.firebasestorage.app", messagingSenderId: "887907470692", appId: "1:887907470692:web:c4142ac9573e19d29d3e71" };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    let currentUser = null;

    onAuthStateChanged(auth, (user) => {
        if (user) {
            currentUser = user;
            checkTask();
        } else { window.location.href = "login.html"; }
    });

    function checkTask() {
        const taskRef = ref(db, 'task2_requests/' + currentUser.uid);
        onValue(taskRef, (snapshot) => {
            const data = snapshot.val();
            hideAll();
            
            if (!data) {
                document.getElementById('applySection').style.display = 'block';
                document.getElementById('statusText').innerText = "Status: Idle";
            } else if (data.status === 'requested') {
                document.getElementById('waitingSection').style.display = 'block';
                document.getElementById('statusText').innerText = "Status: Pending Admin";
            } else if (data.status === 'assigned') {
                document.getElementById('workSection').style.display = 'block';
                document.getElementById('statusText').innerText = "Status: Task Assigned";
                // Show Admin Data
                document.getElementById('showFname').innerText = data.adminData.fname;
                document.getElementById('showEmail').innerText = data.adminData.email;
                document.getElementById('showPass').innerText = data.adminData.password;
            } else if (data.status === 'submitted') {
                document.getElementById('reviewSection').style.display = 'block';
                document.getElementById('statusText').innerText = "Status: Under Review";
            } else if (data.status === 'completed') {
                document.getElementById('completedSection').style.display = 'block';
                document.getElementById('statusText').innerText = "Status: Completed";
                document.getElementById('rewardAmount').innerText = data.reward || 0;
            }
        });
    }

    function hideAll() {
        ['applySection', 'waitingSection', 'workSection', 'reviewSection', 'completedSection'].forEach(id => {
            document.getElementById(id).style.display = 'none';
        });
    }

    window.applyTask = () => {
        set(ref(db, 'task2_requests/' + currentUser.uid), {
            status: 'requested',
            userEmail: currentUser.email,
            timestamp: Date.now()
        });
    };

    window.submitWork = () => {
        const email = document.getElementById('subEmail').value;
        const pass = document.getElementById('subPass').value;
        if(!email || !pass) return alert("Fill all fields");
        
        update(ref(db, 'task2_requests/' + currentUser.uid), {
            status: 'submitted',
            submission: { email: email, password: pass }
        });
    };

    window.resetTask = () => {
        remove(ref(db, 'task2_requests/' + currentUser.uid));
    };
</script>
</body>
</html>
